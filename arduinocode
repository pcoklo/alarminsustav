#include <SoftwareSerial.h>

SoftwareSerial my1Serial(2,3); // RX, TX

int ledPin = 13;
int redLed = A3;
int inPin = A5;
int lockPin = A4;
int led7Pin = 7;

String inputString = "";
String nullString = "";
String key1String = "0300C49D207A"; 
String key2String = "AAA";
String key3String = "BBB";
String key4String = "CCC";
String key5String = "GGG";

boolean flag1 = true;

void setup() {
  Serial.begin(9600);
  my1Serial.begin(9600);
  pinMode(redLed, OUTPUT);
  pinMode(ledPin, OUTPUT);
  pinMode(led7Pin, OUTPUT);
  pinMode(lockPin, INPUT_PULLUP);
  pinMode(inPin, INPUT_PULLUP);
}//setup

void loop(){
  if(my1Serial.available()>0){
    my1Serial.read();
    delay(10);
    while(inputString.length()<12){
      inputString +=char(my1Serial.read());
      delay(10);
    }
    digitalWrite(led7Pin, HIGH);
    my1Serial.read();
    
    if(my1Serial.available()==0) check();
  }//if(my1Serial.available()>0)
  
  while (Serial.available() > 0) {
    inputString +=char(Serial.read());
    delay(10);
    if(Serial.available()==0) check();
  }
  digitalWrite(redLed,flag1);
  if (digitalRead(lockPin) == LOW && digitalRead(inPin) == LOW) flag1=true;
  if (digitalRead(inPin) == HIGH && flag1) digitalWrite(ledPin, 1); 
  else digitalWrite(ledPin, 0);
}//loop

void check(){
  digitalWrite(led7Pin, LOW);
  if(inputString == key1String) unlock();
  else if(inputString == key2String) unlock();
  else if(inputString == key3String) unlock();
  else if(inputString == key4String) unlock();
  else if(inputString == key5String) unlock();
  else{
    Serial.println("Autorizacija neuspjesna!");
    inputString=nullString;
  }//else
}//check()

void unlock(){
  Serial.println("Autorizacija uspjesna!");
  Serial.println("Alarm deaktiviran!");
  flag1=false;
  inputString=nullString;
}
